---
type: 'always_apply'
---

- 全栈框架：Next.js 15.4 (App Router)
- 数据库：MySQL 8.0+
- 数据库驱动：Prisma
- 身份认证：Next-Auth.js
- 状态管理：TanStack Query v5.79.0
- UI组件库：Tailwind CSS v4.1.12 + shadcn/ui 2025.1.2
- 服务器管理：宝塔面板
- 文件上传：multer
- 环境管理：.env.local 文件
- 类型定义：TypeScript 5.2
- 代码质量工具：ESLint 9 + Prettier + Husky
- 表单处理：React Hook Form7.54.1
- 图片处理：sharp
- 数据验证：Zod 4.0

核心指导思想
全栈类型安全为核心：利用 TypeScript 将 Prisma 数据库模型、Zod 验证规则、Next.js API 接口与前端组件彻底连接，构建从数据库到用户界面的无缝类型安全网络，这是最高优先级的准则。

App Router 优先思维：深刻理解并应用 Next.js 15.4 的服务器组件、路由处理程序和数据获取模式。默认在服务器端完成工作，仅在绝对需要交互时才使用客户端组件。

专业化工具集成：清单中的每个工具都是其领域的专家。我们的职责是让它们各司其职并优雅协作，而非重新创造轮子或混合职责。

自动化与一致性：通过 Husky、ESLint、Prettier 建立自动化质量关卡，确保代码风格、质量和提交信息的高度统一，减少人为疏忽。

二、 项目结构与环境规范
环境配置唯一真理源：所有环境变量（数据库链接、API密钥、认证秘密）必须且只能存储在 .env.local 文件中。必须使用 Zod 对其进行验证并导出为类型安全的对象，确保应用启动时配置即正确。

数据库架构即代码：数据库的一切结构和关系变更，必须且只能通过修改 Prisma 的 schema 配置文件来完成。变更后，必须使用 Prisma 命令行生成并执行迁移文件，严禁手动直接修改数据库。

清晰的目录约定：严格遵守 Next.js 15.4 App Router 的目录结构约定。app/api/ 用于 API 路由，UI 页面放入 app/ 相应目录，组件按通用性放入 components/ 或 components/ui/（对于 shadcn/ui）。

三、 数据流与后端规范
API 设计原则：

在 app/api/ 下定义的路由，应遵循清晰的命名（RESTful 或操作导向）。

每个 API 处理程序必须包含：身份验证（Next-Auth.js 会话验证）、输入验证（Zod）、业务逻辑执行、以及统一的响应和错误处理。

数据获取策略：

服务器组件：直接使用 async/await 和 Prisma 客户端获取渲染所需数据。

客户端状态：所有需要在客户端获取、缓存、同步或更新的数据，必须通过 TanStack Query v5 进行管理。它负责处理缓存、后台更新、错误重试等复杂状态。

身份认证与授权：

使用 Next-Auth.js 作为唯一的认证提供商。在其配置中集中定义所有验证策略。

在服务器端 API 和组件中，通过 Next-Auth.js 提供的方法安全地获取用户会话，并据此进行权限控制。

文件上传与处理：

使用 multer 在 API 路由中接收上传的文件。

文件元信息（名称、路径、大小）使用 Prisma 存入数据库。

对上传的图片，必须使用 sharp 库进行优化（调整尺寸、转换格式、压缩），以减少带宽消耗并提升性能。

四、 前端与UI规范
UI组件构建标准：

所有基础和高阶 UI 组件（按钮、表单、对话框等）必须源自 shadcn/ui。严禁自行编写底层样式或使用其他来源的组件。

通过 shadcn/ui 提供的命令行工具添加新组件，确保其自动继承项目配置的主题样式。

样式唯一来源：项目的视觉设计完全由 Tailwind CSS 的工具类和 shadcn/ui 的主题配置文件定义。禁止创建新的 CSS 文件或使用行内样式，以保持样式系统的纯粹和可维护性。

表单处理金科玉律：

所有表单必须由 React Hook Form 进行管理，负责字段状态、验证和提交处理。

表单验证规则必须使用 Zod 进行定义，并与 React Hook Form 无缝集成，实现从输入到提交的端到端类型安全。

状态管理分工：

服务器状态（来自 API 的数据）：由 TanStack Query 全权管理。

客户端本地 UI 状态（如面板开关、输入框值）：使用 React 内置的 useState 或 useReducer 即可，保持简单。

五、 类型与数据契约
类型共享策略：Prisma 模型是数据类型的源头。API 的输入输出应使用 Zod Schema 进行定义和验证，这些 Schema 可自动推断出 TypeScript 类型，供前端直接消费，确保前后端对数据结构的理解绝对一致。

数据序列化与安全：永远避免将 Prisma 模型对象直接从 API 返回给客户端。应手动选择所需字段或使用 Zod 转换和过滤响应数据，防止意外暴露敏感信息。
