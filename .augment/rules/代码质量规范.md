---
type: 'manual'
---

# 代码风格规范

## 📋 总则

本项目严格遵循全栈开发执行手册，结合行业最佳实践，制定统一的代码风格规范。

### 核心原则

- **类型安全优先**: 禁用any类型，强制明确类型定义
- **约定优于配置**: 遵循工具官方推荐的默认方式
- **一致性**: 整个项目保持统一的代码风格
- **可维护性**: 代码清晰易读，便于团队协作

## 🏗️ 文件命名规范

### 目录命名

```
app/                    # Next.js App Router (kebab-case)
components/            # 组件目录 (kebab-case)
├── ui/               # shadcn/ui组件 (kebab-case)
└── common/           # 业务组件 (kebab-case)
lib/                  # 工具库 (kebab-case)
```

### 文件命名

```typescript
// ✅ 组件文件：PascalCase（优先级最高）
Header.tsx;
Button.tsx;
UserProfile.tsx;

// ✅ 工具文件：kebab-case
user - utils.ts;
data - validation.ts;
api - client.ts;

// ✅ 类型文件：kebab-case
user - types.ts;
api - types.ts;
```

## 📝 TypeScript规范

### 类型定义

```typescript
// ✅ 正确：明确的类型定义
interface UserCreateInput {
  name: string;
  email: string;
  role?: UserRole;
}

// ✅ 正确：使用枚举提高类型安全
const enum UserRole {
  ADMIN = 'admin',
  SALES = 'sales',
}

// ❌ 错误：使用any类型
function processData(data: any) {}

// ✅ 正确：使用泛型
function processData<T>(data: T): T {}
```

### 接口命名约定

```typescript
// ✅ 正确：PascalCase，无I前缀
interface ButtonProps {
  variant?: 'default' | 'destructive';
  children: React.ReactNode;
}

// ✅ 正确：组件Props接口命名
interface UserCardProps {
  user: User;
  onEdit?: (user: User) => void;
}

// ❌ 错误：使用I前缀
interface IButtonProps {}
```

### 导入顺序

```typescript
// ✅ 正确的导入顺序
// 1. 第三方库
import React from 'react';
import { useQuery } from '@tanstack/react-query';

// 2. 绝对路径导入
import { Button } from '@/components/ui/button';
import { createUser } from '@/lib/api/users';

// 3. 相对路径导入
import './styles.css';
```

## ⚛️ React组件规范

### 组件定义方式

```typescript
// ✅ 推荐：使用React.forwardRef（适用于UI组件）
const Button = React.forwardRef<HTMLButtonElement, ButtonProps>(
  ({ variant = 'default', children, ...props }, ref) => {
    return (
      <button ref={ref} className={cn(buttonVariants({ variant }))} {...props}>
        {children}
      </button>
    );
  }
);

Button.displayName = 'Button';

// ✅ 推荐：箭头函数组件（适用于业务组件）
const UserProfile = ({ user, onEdit }: UserProfileProps) => {
  return (
    <div className="space-y-4">
      <h2>{user.name}</h2>
      <Button onClick={() => onEdit?.(user)}>编辑</Button>
    </div>
  );
};

// ✅ 可选：命名函数组件（适用于复杂组件）
function UserDashboard({ userId }: UserDashboardProps) {
  const { data: user } = useQuery({
    queryKey: ['user', userId],
    queryFn: () => fetchUser(userId),
  });

  if (!user) return <div>加载中...</div>;

  return <div>{/* 复杂组件逻辑 */}</div>;
}
```

### 事件处理函数命名

```typescript
// ✅ 正确：使用handle前缀
const handleSubmit = (data: FormData) => {};
const handleUserEdit = (user: User) => {};
const handleModalClose = () => {};

// ❌ 错误：不明确的命名
const onSubmit = () => {};
const click = () => {};
```

### 自定义钩子命名

```typescript
// ✅ 正确：使用use前缀
const useUserData = (userId: string) => {};
const useLocalStorage = (key: string) => {};

// ❌ 错误：缺少use前缀
const getUserData = () => {};
```

## 🎨 样式规范

### Tailwind CSS使用

```typescript
// ✅ 正确：使用Tailwind工具类
<div className="flex items-center justify-between p-4 bg-white rounded-lg shadow-sm">
  <h2 className="text-lg font-semibold text-gray-900">标题</h2>
  <Button size="sm">操作</Button>
</div>

// ❌ 错误：使用内联样式
<div style={{ display: 'flex', padding: '16px' }}>
  内容
</div>

// ❌ 错误：创建自定义CSS文件
// custom.css
.my-custom-style { ... }
```

### 组件库使用

```typescript
// ✅ 正确：使用shan/ui组件
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';

<Button variant="default">点击</Button>
<Input placeholder="请输入..." />

// ❌ 错误：直接使用原生HTML元素
<button className="...">点击</button>
<input className="..." />
```

## 🔧 状态管理规范

### 本地状态

```typescript
// ✅ 正确：使用useState处理本地UI状态
const [isOpen, setIsOpen] = useState(false);
const [formData, setFormData] = useState<FormData>({});

// ✅ 正确：使用useReducer处理复杂状态
const [state, dispatch] = useReducer(reducer, initialState);
```

### 服务器状态

```typescript
// ✅ 正确：使用TanStack Query管理服务器状态
const { data: users, isLoading } = useQuery({
  queryKey: ['users'],
  queryFn: fetchUsers,
});

const createUserMutation = useMutation({
  mutationFn: createUser,
  onSuccess: () => {
    queryClient.invalidateQueries({ queryKey: ['users'] });
  },
});
```

## 📊 代码质量要求

### 文件和函数长度限制

```typescript
// ✅ 文件长度：不超过300行
// ✅ 函数长度：不超过50行
// ✅ 圈复杂度：不超过10
// ✅ 认知复杂度：不超过15

// ❌ 错误：过长的函数
function processUserData() {
  // 超过50行的函数逻辑
}

// ✅ 正确：拆分为多个小函数
function validateUserData(data: UserData) {}
function transformUserData(data: UserData) {}
function saveUserData(data: UserData) {}
```

### 错误处理

```typescript
// ✅ 正确：使用TypeScript的never类型
function assertNever(value: never): never {
  throw new Error(`Unexpected value: ${value}`);
}

// ✅ 正确：使用Zod进行运行时验证
const userSchema = z.object({
  name: z.string().min(1),
  email: z.string().email(),
});

// ✅ 正确：异步操作包含错误处理
try {
  const user = await createUser(userData);
  return { success: true, data: user };
} catch (error) {
  return { success: false, error: error.message };
}
```

## 🔒 安全规范

```typescript
// ✅ 正确：验证用户输入
const sanitizedInput = userSchema.parse(userInput);

// ✅ 正确：API路由身份验证
export async function POST(request: Request) {
  const session = await getServerSession(authOptions);
  if (!session) {
    return NextResponse.json({ error: '未授权' }, { status: 401 });
  }
  // 处理请求...
}

// ❌ 错误：直接使用用户输入
const html = `<div>${userInput}</div>`; // XSS风险
```

## 📚 注释规范

```typescript
/**
 * 创建新用户
 * @param userData 用户数据
 * @returns 创建的用户信息
 */
export async function createUser(userData: UserCreateInput): Promise<User> {
  // 复杂算法需要解释性注释
  const hashedPassword = await bcrypt.hash(userData.password, 12);

  // TODO: 添加邮件验证功能 - 负责人: 张三 - 截止日期: 2024-02-01
  return await db.user.create({
    data: { ...userData, password: hashedPassword },
  });
}
```

## ✅ 自动化检查

项目已配置以下自动化工具：

- **ESLint**: 代码质量检查
- **Prettier**: 代码格式化
- **TypeScript**: 类型检查
- **Husky**: Git hooks管理
- **lint-staged**: 提交前检查

遵循这些规范，确保代码质量和项目的长期可维护性！
