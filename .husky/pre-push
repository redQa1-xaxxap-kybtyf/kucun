#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” è¿è¡Œpre-pushæ£€æŸ¥..."

# 1. TypeScriptç±»å‹æ£€æŸ¥
echo "ğŸ“ æ£€æŸ¥TypeScriptç±»å‹..."
npm run type-check
if [ $? -ne 0 ]; then
    echo "âŒ TypeScriptç±»å‹æ£€æŸ¥å¤±è´¥ï¼"
    exit 1
fi

# 2. ESLintæ£€æŸ¥
echo "ğŸ” è¿è¡ŒESLintæ£€æŸ¥..."
npm run lint
if [ $? -ne 0 ]; then
    echo "âŒ ESLintæ£€æŸ¥å¤±è´¥ï¼"
    exit 1
fi

# 3. Prettieræ ¼å¼æ£€æŸ¥
echo "ğŸ’… æ£€æŸ¥ä»£ç æ ¼å¼..."
npm run format:check
if [ $? -ne 0 ]; then
    echo "âŒ ä»£ç æ ¼å¼æ£€æŸ¥å¤±è´¥ï¼è¯·è¿è¡Œ npm run format ä¿®å¤æ ¼å¼é—®é¢˜ã€‚"
    exit 1
fi

# 4. æ„å»ºæ£€æŸ¥
echo "ğŸ—ï¸  æ£€æŸ¥é¡¹ç›®æ„å»º..."
npm run build
if [ $? -ne 0 ]; then
    echo "âŒ é¡¹ç›®æ„å»ºå¤±è´¥ï¼"
    exit 1
fi

# 5. è¿è¡Œæµ‹è¯•ï¼ˆå¦‚æœå­˜åœ¨æµ‹è¯•æ–‡ä»¶ï¼‰
if [ -d "__tests__" ] || [ -d "tests" ] || find . -name "*.test.*" -o -name "*.spec.*" | grep -q .; then
    echo "ğŸ§ª è¿è¡Œæµ‹è¯•å¥—ä»¶..."
    npm run test:ci
    if [ $? -ne 0 ]; then
        echo "âŒ æµ‹è¯•å¤±è´¥ï¼"
        exit 1
    fi
else
    echo "â„¹ï¸  æœªå‘ç°æµ‹è¯•æ–‡ä»¶ï¼Œè·³è¿‡æµ‹è¯•æ£€æŸ¥"
fi

echo "âœ… æ‰€æœ‰pre-pushæ£€æŸ¥é€šè¿‡ï¼"
