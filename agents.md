全局约定规范

在没有任何指令的情况下，严禁编写任何测试文件，统一使用 Playwright 浏览器来检查问题。

本文档解决现有规范文档中的冲突和空白，确立项目的最终决策标准。

遵循代码质量规范

使用 Context 7 获取最佳实践和技术栈的最新文档

技术栈

全栈框架: Next.js 15.4 (App Router)

数据库: MySQL 8.0+

数据库驱动: Prisma

身份认证: Next-Auth.js

状态管理: TanStack Query v5.79.0

UI组件库: Tailwind CSS v4.1.12 + shadcn/ui 2025.1.2

服务器管理: 宝塔面板

文件上传: multer

环境管理: .env.local 文件

类型定义: TypeScript 5.2

代码质量工具: ESLint 9 + Prettier + Husky

表单处理: React Hook Form 7.54.1

图片处理: sharp

数据验证: Zod 4.0

WebSocket: ws

缓存与消息队列: Redis

核心指导思想

全栈类型安全
通过 TypeScript 完全连接 Prisma 数据库模型、Zod 验证规则、Next.js API 接口与前端组件，确保数据库与用户界面之间的无缝类型安全。

App Router 优先
使用 Next.js 15.4 的服务器组件、路由处理程序和数据获取模式，优先在服务器端处理工作，客户端组件仅在必要时使用。

专业化工具集成
利用清单中的每个工具作为专家，确保各司其职，协作优雅，而非重新发明轮子。

自动化与一致性
通过 Husky、ESLint、Prettier 建立自动化质量关卡，确保代码风格和质量的一致性，避免人为疏忽。

项目结构与环境规范

唯一真理源原则
所有环境变量必须存储在 .env.local 中，并使用 Zod 进行验证，确保应用启动时配置正确。

数据库架构即代码
数据库结构和关系的变更必须通过修改 Prisma 的 schema 文件来完成，严禁直接修改数据库。

清晰的目录约定
遵循 Next.js 15.4 App Router 的目录结构，按功能组织项目代码，组件放置在 components/ 或 components/ui/。

数据流与后端规范

API 设计原则
路由采用 RESTful 或操作导向命名，API 必须包含身份验证、输入验证、业务逻辑执行，以及统一的响应和错误处理。

数据获取策略
服务器组件直接使用 Prisma 客户端获取数据，客户端数据管理通过 TanStack Query 实现，确保数据同步、缓存和更新的一致性。

身份认证与授权
唯一使用 Next-Auth.js 进行认证管理，并在 API 和组件中通过其方法安全地获取用户会话和控制权限。

文件上传与处理
使用 multer 处理文件上传，图片通过 sharp 库进行优化，确保性能和带宽的有效管理。

实时通信
通过 WebSocket (ws) 建立实时通信机制，支持消息推送、状态同步、事件驱动更新。

缓存与队列
使用 Redis 实现数据缓存、会话存储和 Pub/Sub 消息队列，支撑高并发和实时应用场景。

前端与 UI 规范

UI组件构建标准
所有 UI 组件都使用 shadcn/ui，确保一致的主题样式，禁止直接自定义底层样式。

表单处理金科玉律
所有表单使用 React Hook Form 和 Zod 定义验证规则，确保端到端类型安全。

状态管理分工
服务器数据通过 TanStack Query 管理，局部 UI 状态通过 React 内置的 useState 或 useReducer 管理。

类型与数据契约

类型共享策略
所有 API 输入输出应使用 Zod Schema 定义，并与 Prisma 数据模型和前端代码无缝对接，确保数据结构一致性。

数据序列化与安全
避免将 Prisma 模型对象直接返回客户端，必须通过 Zod 或其他方式处理数据转换，避免暴露敏感信息。

代码质量与提交约定

自动化工具
使用 Husky 和 ESLint 保障代码质量，确保格式化、检查和提交信息统一，减少人为错误。

函数与文件大小限制
每个函数不超过 50 行，每个文件不超过 300 行，确保代码的清晰性和可维护性。

提交信息规范
遵循 Conventional Commits 规范，确保提交信息清晰并有助于团队协作。

ESLint 规范

代码检查与格式化
确保项目通过 ESLint 和 Prettier 进行代码格式化与检查，自动修复大部分问题，并手动处理细节问题。
ESLint 规则应涵盖所有 TypeScript 类型检查、空值断言、导入顺序等问题。

备注：本规范为最终决策文档，如有冲突以此为准
