# äº§å“ç®¡ç†æ¨¡å—ä»£ç è´¨é‡æ£€æŸ¥æŠ¥å‘Š

## ğŸ“Š æ£€æŸ¥æ¦‚è§ˆ

**æ£€æŸ¥èŒƒå›´**ï¼š

- `app/(dashboard)/products/` - äº§å“é¡µé¢æ–‡ä»¶
- `components/products/` - äº§å“ç»„ä»¶æ–‡ä»¶
- `lib/api/products.ts` - äº§å“APIå®¢æˆ·ç«¯
- `lib/types/product.ts` - äº§å“ç±»å‹å®šä¹‰

**æ£€æŸ¥ç»“æœ**ï¼š

- **Errorçº§åˆ«é”™è¯¯**: 25ä¸ª âŒ
- **Warningçº§åˆ«è­¦å‘Š**: 8ä¸ª âš ï¸
- **TypeScriptç¼–è¯‘é”™è¯¯**: 18ä¸ª ğŸ”´
- **ä»£ç è´¨é‡è¯„çº§**: Dçº§ (éœ€è¦ç«‹å³ä¿®å¤)

---

## ğŸš¨ Errorçº§åˆ«é—®é¢˜ï¼ˆå¿…é¡»ä¿®å¤ï¼‰

### 1. anyç±»å‹æ»¥ç”¨ (9ä¸ªé”™è¯¯)

**ä½ç½®åŠé—®é¢˜**ï¼š

```typescript
// lib/types/product.ts:9
specifications?: Record<string, any>;

// components/products/product-form.tsx:167
const onSubmit = async (data: any) => {

// components/products/specifications-editor.tsx:26,221,274
control: Control<any>;
```

**ä¿®å¤æ–¹æ¡ˆ**ï¼š

```typescript
// âœ… æ­£ç¡®åšæ³•
interface TileSpecifications {
  color?: string;
  surface?: string;
  size?: string;
  thickness?: number;
  pattern?: string;
  grade?: string;
  origin?: string;
  series?: string;
  [key: string]: string | number | undefined;
}

interface Product {
  specifications?: TileSpecifications;
}

// è¡¨å•ç±»å‹
interface ProductFormData {
  id: string;
  code: string;
  name: string;
  // ... å…¶ä»–å­—æ®µ
}

const onSubmit = async (data: ProductFormData) => {
```

### 2. éç©ºæ–­è¨€æ»¥ç”¨ (5ä¸ªé”™è¯¯)

**ä½ç½®åŠé—®é¢˜**ï¼š

```typescript
// lib/api/products.ts:87,115,147,201
return data.data!;

// components/products/product-form.tsx:132
updateProduct(initialData!.id, data);
```

**ä¿®å¤æ–¹æ¡ˆ**ï¼š

```typescript
// âœ… æ­£ç¡®åšæ³•
if (!data.success || !data.data) {
  throw new Error(data.error || 'æ“ä½œå¤±è´¥');
}
return data.data;

// è¡¨å•ä¸­çš„å®‰å…¨æ£€æŸ¥
if (!initialData?.id) {
  throw new Error('äº§å“IDä¸èƒ½ä¸ºç©º');
}
updateProduct(initialData.id, data);
```

### 3. å¯¼å…¥é¡ºåºæ··ä¹± (4ä¸ªé”™è¯¯)

**ä½ç½®åŠé—®é¢˜**ï¼š

```typescript
// components/products/product-form.tsx:7,40
import { useState } from 'react';
// ç©ºè¡Œä¸åº”è¯¥åœ¨å¯¼å…¥ç»„å†…
import { Textarea } from '@/components/ui/textarea';
```

**ä¿®å¤æ–¹æ¡ˆ**ï¼š

```typescript
// âœ… æ­£ç¡®çš„å¯¼å…¥é¡ºåº
import { useState } from 'react';
import { useRouter } from 'next/navigation';
import { zodResolver } from '@hookform/resolvers/zod';
import { useMutation, useQueryClient } from '@tanstack/react-query';
import { AlertCircle, ArrowLeft, Loader2, Package, Save } from 'lucide-react';

import { ImageUpload } from '@/components/common/image-upload';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';

import { createProduct, updateProduct } from '@/lib/api/products';
import type { Product, ProductCreateInput } from '@/lib/types/product';
```

### 4. é‡å¤å¯¼å…¥ (2ä¸ªé”™è¯¯)

**ä½ç½®åŠé—®é¢˜**ï¼š

```typescript
// components/products/product-form.tsx:57
import { PRODUCT_STATUS_LABELS } from '@/lib/types/product';
// ä¸ç¬¬58è¡Œé‡å¤å¯¼å…¥

// components/products/specifications-editor.tsx:5
import { useFieldArray } from 'react-hook-form';
// ä¸ç¬¬4è¡Œé‡å¤å¯¼å…¥
```

---

## âš ï¸ Warningçº§åˆ«é—®é¢˜ï¼ˆå»ºè®®ä¿®å¤ï¼‰

### 1. æ–‡ä»¶é•¿åº¦è¶…é™ (4ä¸ªè­¦å‘Š)

**é—®é¢˜æ–‡ä»¶**ï¼š

- `components/products/product-form.tsx`: 481è¡Œ (é™åˆ¶300è¡Œ)
- `app/(dashboard)/products/page.tsx`: 808è¡Œ (é™åˆ¶300è¡Œ)
- `components/products/product-selector.tsx`: 302è¡Œ (é™åˆ¶300è¡Œ)
- `components/products/specifications-editor.tsx`: 360è¡Œ (é™åˆ¶300è¡Œ)

**ä¿®å¤å»ºè®®**ï¼š

```typescript
// æ‹†åˆ† product-form.tsx
ProductForm.tsx (ä¸»ç»„ä»¶)
â”œâ”€â”€ ProductBasicInfo.tsx (åŸºç¡€ä¿¡æ¯è¡¨å•)
â”œâ”€â”€ ProductSpecifications.tsx (è§„æ ¼ä¿¡æ¯)
â”œâ”€â”€ ProductImages.tsx (å›¾ç‰‡ä¸Šä¼ )
â””â”€â”€ ProductFormActions.tsx (æ“ä½œæŒ‰é’®)
```

### 2. å‡½æ•°é•¿åº¦è¶…é™ (4ä¸ªè­¦å‘Š)

**é—®é¢˜å‡½æ•°**ï¼š

- `ProductForm`: 420è¡Œ (é™åˆ¶50è¡Œ)
- `ProductsPage`: 654è¡Œ (é™åˆ¶50è¡Œ)
- `ProductSelector`: 131è¡Œ (é™åˆ¶50è¡Œ)
- `SpecificationsEditor`: 176è¡Œ (é™åˆ¶50è¡Œ)

---

## ğŸ”´ TypeScriptç±»å‹å®‰å…¨é—®é¢˜

### 1. Prismaæ¨¡å‹ä¸TypeScriptç±»å‹ä¸ä¸€è‡´

**æ•°æ®åº“å­—æ®µ (snake_case)**ï¼š

```sql
pieces_per_unit INT
created_at DATETIME
updated_at DATETIME
```

**TypeScriptç±»å‹ (camelCase)**ï¼š

```typescript
interface Product {
  piecesPerUnit: number;
  createdAt: string;
  updatedAt: string;
}
```

**é—®é¢˜**: ç¼ºå°‘è‡ªåŠ¨è½¬æ¢æœºåˆ¶

### 2. ZodéªŒè¯è§„åˆ™ä¸ç±»å‹å®šä¹‰ä¸åŒ¹é…

**é—®é¢˜ç¤ºä¾‹**ï¼š

```typescript
// lib/types/product.ts
specifications?: Record<string, any>; // âŒ ä½¿ç”¨any

// lib/validations/product.ts
specifications: z.record(z.unknown()) // âŒ ä¸ä¸€è‡´
```

---

## ğŸ› ï¸ ä¿®å¤ä¼˜å…ˆçº§ä¸å»ºè®®

### ç¬¬ä¸€ä¼˜å…ˆçº§ï¼ˆç«‹å³ä¿®å¤ï¼‰

1. **æ›¿æ¢æ‰€æœ‰anyç±»å‹** - å½±å“ç±»å‹å®‰å…¨
2. **ç§»é™¤éç©ºæ–­è¨€** - é˜²æ­¢è¿è¡Œæ—¶é”™è¯¯
3. **ä¿®å¤å¯¼å…¥é¡ºåº** - æå‡ä»£ç å¯è¯»æ€§
4. **æ¶ˆé™¤é‡å¤å¯¼å…¥** - æ¸…ç†ä»£ç 

### ç¬¬äºŒä¼˜å…ˆçº§ï¼ˆé€æ­¥æ”¹è¿›ï¼‰

1. **æ‹†åˆ†é•¿æ–‡ä»¶** - æå‡ç»´æŠ¤æ€§
2. **æ‹†åˆ†é•¿å‡½æ•°** - æå‡å¯è¯»æ€§
3. **ç»Ÿä¸€å‘½åçº¦å®š** - ç¡®ä¿ä¸€è‡´æ€§

### ç¬¬ä¸‰ä¼˜å…ˆçº§ï¼ˆä¼˜åŒ–æå‡ï¼‰

1. **å®Œå–„é”™è¯¯å¤„ç†** - æå‡ç”¨æˆ·ä½“éªŒ
2. **æ·»åŠ å•å…ƒæµ‹è¯•** - ä¿è¯ä»£ç è´¨é‡
3. **æ€§èƒ½ä¼˜åŒ–** - æå‡å“åº”é€Ÿåº¦

---

## ğŸ“ˆ ä¿®å¤åé¢„æœŸæ•ˆæœ

**ä»£ç è´¨é‡è¯„çº§**: Dçº§ â†’ Açº§
**ç±»å‹å®‰å…¨è¦†ç›–ç‡**: 60% â†’ 95%
**ESLinté”™è¯¯æ•°**: 25ä¸ª â†’ 0ä¸ª
**ç»´æŠ¤æ€§è¯„åˆ†**: 3/10 â†’ 8/10

---

## ğŸ”§ è‡ªåŠ¨ä¿®å¤è„šæœ¬

```bash
# 1. è¿è¡Œè‡ªåŠ¨ä¿®å¤
npm run lint:fix

# 2. ç±»å‹æ£€æŸ¥
npm run type-check

# 3. æ ¼å¼åŒ–ä»£ç 
npm run format
```

**é¢„è®¡ä¿®å¤æ—¶é—´**: 4-6å°æ—¶
**å»ºè®®ä¿®å¤é¡ºåº**: Error â†’ Warning â†’ TypeScript â†’ ä¼˜åŒ–

---

## ğŸ“ å…·ä½“ä¿®å¤ä»£ç ç¤ºä¾‹

### 1. ä¿®å¤lib/types/product.tsä¸­çš„anyç±»å‹

```typescript
// âŒ ä¿®å¤å‰
export interface Product {
  specifications?: Record<string, any>;
}

// âœ… ä¿®å¤å
export interface TileSpecifications {
  color?: string; // é¢œè‰²
  surface?: string; // è¡¨é¢å¤„ç†
  size?: string; // å°ºå¯¸è§„æ ¼
  thickness?: number; // åšåº¦(mm)
  pattern?: string; // èŠ±çº¹
  grade?: string; // ç­‰çº§
  origin?: string; // äº§åœ°
  series?: string; // ç³»åˆ—
  [key: string]: string | number | undefined; // æ‰©å±•å­—æ®µ
}

export interface Product {
  id: string;
  code: string;
  name: string;
  specification?: string;
  specifications?: TileSpecifications;
  unit: ProductUnit;
  piecesPerUnit: number;
  weight?: number;
  thickness?: number;
  status: ProductStatus;
  categoryId?: string;
  category?: ProductCategory;
  createdAt: string;
  updatedAt: string;
  inventory?: ProductInventory;
  statistics?: ProductStatistics;
}
```

### 2. ä¿®å¤components/products/product-form.tsx

```typescript
// âŒ ä¿®å¤å‰
const onSubmit = async (data: any) => {
  // ...
  await updateMutation.mutateAsync(updateData as any);
};

// âœ… ä¿®å¤å
interface ProductFormData {
  id: string;
  code: string;
  name: string;
  specification?: string;
  specifications?: TileSpecifications;
  unit: ProductUnit;
  piecesPerUnit: number;
  weight?: number;
  thickness?: number;
  status?: ProductStatus;
  categoryId?: string;
}

const onSubmit = async (data: ProductFormData) => {
  setSubmitError('');

  try {
    if (isEdit) {
      if (!initialData?.id) {
        throw new Error('äº§å“IDä¸èƒ½ä¸ºç©º');
      }

      const updateData: ProductUpdateInput = {
        ...data,
        weight: data.weight === 0 ? undefined : data.weight,
        thickness: data.thickness === 0 ? undefined : data.thickness,
      };

      await updateMutation.mutateAsync(updateData);
    } else {
      const createData: ProductCreateInput = {
        ...data,
        weight: data.weight === 0 ? undefined : data.weight,
        thickness: data.thickness === 0 ? undefined : data.thickness,
      };

      await createMutation.mutateAsync(createData);
    }
  } catch (error) {
    // é”™è¯¯å·²åœ¨ mutation çš„ onError ä¸­å¤„ç†
  }
};
```

### 3. ä¿®å¤lib/api/products.tsä¸­çš„éç©ºæ–­è¨€

```typescript
// âŒ ä¿®å¤å‰
export async function getProduct(id: string): Promise<Product> {
  // ...
  return data.data!;
}

// âœ… ä¿®å¤å
export async function getProduct(id: string): Promise<Product> {
  const response = await fetch(`${API_BASE}/${id}`, {
    method: 'GET',
    headers: {
      'Content-Type': 'application/json',
    },
    credentials: 'include',
  });

  if (!response.ok) {
    if (response.status === 404) {
      throw new Error('äº§å“ä¸å­˜åœ¨');
    }
    throw new Error(`è·å–äº§å“è¯¦æƒ…å¤±è´¥: ${response.statusText}`);
  }

  const data: ApiResponse<Product> = await response.json();

  if (!data.success) {
    throw new Error(data.error || 'è·å–äº§å“è¯¦æƒ…å¤±è´¥');
  }

  if (!data.data) {
    throw new Error('æœåŠ¡å™¨è¿”å›æ•°æ®ä¸ºç©º');
  }

  return data.data;
}
```

### 4. ä¿®å¤å¯¼å…¥é¡ºåºé—®é¢˜

```typescript
// âŒ ä¿®å¤å‰ - components/products/product-form.tsx
import { zodResolver } from '@hookform/resolvers/zod';
import { useMutation, useQueryClient } from '@tanstack/react-query';
import { AlertCircle, ArrowLeft, Loader2, Package, Save } from 'lucide-react';
import { useRouter } from 'next/navigation';
import { useState } from 'react';

// UI Components
import { useForm } from 'react-hook-form';

// âœ… ä¿®å¤å
('use client');

// Reactç›¸å…³
import { useState } from 'react';
import { useRouter } from 'next/navigation';

// ç¬¬ä¸‰æ–¹åº“
import { zodResolver } from '@hookform/resolvers/zod';
import { useForm } from 'react-hook-form';
import { useMutation, useQueryClient } from '@tanstack/react-query';
import { AlertCircle, ArrowLeft, Loader2, Package, Save } from 'lucide-react';

// UIç»„ä»¶
import { Alert, AlertDescription } from '@/components/ui/alert';
import { Button } from '@/components/ui/button';
import {
  Card,
  CardContent,
  CardDescription,
  CardHeader,
  CardTitle,
} from '@/components/ui/card';
import {
  Form,
  FormControl,
  FormDescription,
  FormField,
  FormItem,
  FormLabel,
  FormMessage,
} from '@/components/ui/form';
import { Input } from '@/components/ui/input';
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select';
import { Textarea } from '@/components/ui/textarea';

// ä¸šåŠ¡ç»„ä»¶
import { ImageUpload } from '@/components/common/image-upload';
import { SpecificationsEditor } from '@/components/products/specifications-editor';

// APIå’Œç±»å‹
import {
  createProduct,
  productQueryKeys,
  updateProduct,
} from '@/lib/api/products';
import type {
  Product,
  ProductCreateInput,
  ProductUpdateInput,
} from '@/lib/types/product';
import {
  PRODUCT_STATUS_LABELS,
  PRODUCT_UNIT_LABELS,
} from '@/lib/types/product';
import {
  productCreateDefaults,
  productCreateSchema,
  productUpdateSchema,
} from '@/lib/validations/product';
```

---

## ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨è®¡åˆ’

1. **ç«‹å³æ‰§è¡Œè‡ªåŠ¨ä¿®å¤**ï¼š`npm run lint:fix`
2. **æ‰‹åŠ¨ä¿®å¤anyç±»å‹**ï¼šæŒ‰ç…§ä¸Šè¿°ç¤ºä¾‹é€ä¸€æ›¿æ¢
3. **ç§»é™¤éç©ºæ–­è¨€**ï¼šæ·»åŠ é€‚å½“çš„ç©ºå€¼æ£€æŸ¥
4. **é‡æ„é•¿æ–‡ä»¶**ï¼šæŒ‰åŠŸèƒ½æ¨¡å—æ‹†åˆ†ç»„ä»¶
5. **æ·»åŠ å•å…ƒæµ‹è¯•**ï¼šç¡®ä¿ä¿®å¤ååŠŸèƒ½æ­£å¸¸
6. **ä»£ç å®¡æŸ¥**ï¼šå›¢é˜Ÿreviewä¿®å¤ç»“æœ

**ä¿®å¤å®Œæˆæ ‡å‡†**ï¼š

- âœ… ESLintæ£€æŸ¥0é”™è¯¯0è­¦å‘Š
- âœ… TypeScriptç¼–è¯‘é€šè¿‡
- âœ… æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹é€šè¿‡
- âœ… ä»£ç è¦†ç›–ç‡>80%
