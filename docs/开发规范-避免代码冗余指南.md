# å¼€å‘è§„èŒƒ - é¿å…ä»£ç å†—ä½™æŒ‡å—

## ğŸ“– æ–‡æ¡£ç›®çš„

æœ¬æ–‡æ¡£æ—¨åœ¨å¸®åŠ©å¼€å‘å›¢é˜Ÿå»ºç«‹è‰¯å¥½çš„ç¼–ç ä¹ æƒ¯ï¼Œé¿å…äº§ç”Ÿå†—ä½™ä»£ç ï¼Œæé«˜ä»£ç è´¨é‡å’Œç»´æŠ¤æ€§ã€‚åŸºäºé¡¹ç›®å®é™…å†—ä½™æ¸…ç†ç»éªŒæ€»ç»“è€Œæˆã€‚

## ğŸ¯ æ ¸å¿ƒåŸåˆ™

### 1. å•ä¸€æ¥æºåŸåˆ™ (Single Source of Truth)
æ¯ä¸ªæ¦‚å¿µã€é…ç½®æˆ–æ•°æ®åœ¨ç³»ç»Ÿä¸­åªæœ‰ä¸€ä¸ªæ˜ç¡®çš„ã€æƒå¨çš„æ¥æºã€‚

### 2. DRYåŸåˆ™ (Don't Repeat Yourself)
é¿å…é‡å¤ä»£ç ï¼Œé€šè¿‡æŠ½è±¡å’Œå¤ç”¨æ¥å‡å°‘é‡å¤ã€‚

### 3. çº¦å®šä¼˜äºé…ç½®
éµå¾ªæ—¢å®šçš„é¡¹ç›®ç»“æ„å’Œå‘½åçº¦å®šï¼Œå‡å°‘ä¸ªäººåŒ–çš„å®ç°å·®å¼‚ã€‚

## ğŸ“ é¡¹ç›®ç»“æ„è§„èŒƒ

### å·¥å…·å‡½æ•°ç»„ç»‡
```
lib/
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ index.ts              # é€šç”¨å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ validation-helpers.ts # éªŒè¯ç›¸å…³å·¥å…·
â”‚   â”œâ”€â”€ style-classes.ts      # æ ·å¼å·¥å…·ç±»
â”‚   â””â”€â”€ date-helpers.ts       # æ—¥æœŸå¤„ç†å·¥å…·
â”œâ”€â”€ constants/
â”‚   â”œâ”€â”€ error-messages.ts     # é”™è¯¯æ¶ˆæ¯å¸¸é‡
â”‚   â”œâ”€â”€ status-values.ts      # çŠ¶æ€å€¼å¸¸é‡
â”‚   â””â”€â”€ api-endpoints.ts      # APIç«¯ç‚¹å¸¸é‡
â””â”€â”€ types/
    â”œâ”€â”€ api.ts               # APIç›¸å…³ç±»å‹
    â”œâ”€â”€ common.ts            # é€šç”¨ç±»å‹
    â””â”€â”€ business.ts          # ä¸šåŠ¡ç±»å‹
```

### ç»„ä»¶ç»„ç»‡
```
components/
â”œâ”€â”€ ui/                      # shadcn/ui åŸºç¡€ç»„ä»¶
â”œâ”€â”€ common/                  # é€šç”¨ä¸šåŠ¡ç»„ä»¶
â”œâ”€â”€ forms/                   # è¡¨å•ç»„ä»¶
â”œâ”€â”€ layouts/                 # å¸ƒå±€ç»„ä»¶
â””â”€â”€ features/                # åŠŸèƒ½ç‰¹å®šç»„ä»¶
```

## ğŸ› ï¸ å¼€å‘å‰æ£€æŸ¥æ¸…å•

### æ–°å¢å‡½æ•°å‰å¿…é¡»æ£€æŸ¥
1. **æœç´¢ç°æœ‰å®ç°**
   ```bash
   # æœç´¢ç›¸ä¼¼åŠŸèƒ½çš„å‡½æ•°
   grep -r "functionName" lib/ components/ app/
   ```

2. **æ£€æŸ¥å·¥å…·å‡½æ•°åº“**
   - æŸ¥çœ‹ `lib/utils/index.ts` æ˜¯å¦æœ‰ç±»ä¼¼åŠŸèƒ½
   - æŸ¥çœ‹ `lib/utils/validation-helpers.ts` éªŒè¯å‡½æ•°
   - æŸ¥çœ‹ `lib/utils/date-helpers.ts` æ—¥æœŸå¤„ç†å‡½æ•°

3. **ç¡®å®šæ”¾ç½®ä½ç½®**
   - é€šç”¨å·¥å…· â†’ `lib/utils/index.ts`
   - éªŒè¯å‡½æ•° â†’ `lib/utils/validation-helpers.ts`
   - ä¸šåŠ¡ç‰¹å®š â†’ å¯¹åº”ä¸šåŠ¡æ¨¡å—

### æ–°å¢å¸¸é‡å‰å¿…é¡»æ£€æŸ¥
1. **æ£€æŸ¥ç°æœ‰å¸¸é‡æ–‡ä»¶**
   - `lib/constants/error-messages.ts` - é”™è¯¯æ¶ˆæ¯
   - `lib/constants/status-values.ts` - çŠ¶æ€å€¼
   - `lib/constants/api-endpoints.ts` - APIç«¯ç‚¹

2. **é¿å…ç¡¬ç¼–ç å­—ç¬¦ä¸²**
   ```typescript
   // âŒ é”™è¯¯åšæ³•
   if (status === 'active') { ... }
   
   // âœ… æ­£ç¡®åšæ³•
   import { STATUS_VALUES } from '@/lib/constants/status-values';
   if (status === STATUS_VALUES.ACTIVE) { ... }
   ```

## ğŸ“‹ å¸¸è§å†—ä½™åœºæ™¯åŠè§£å†³æ–¹æ¡ˆ

### 1. æ ¼å¼åŒ–å‡½æ•°å†—ä½™

#### âŒ é”™è¯¯åšæ³•
```typescript
// åœ¨å¤šä¸ªæ–‡ä»¶ä¸­é‡å¤å®šä¹‰
const formatCurrency = (amount: number) => {
  return new Intl.NumberFormat('zh-CN', {
    style: 'currency',
    currency: 'CNY'
  }).format(amount);
};
```

#### âœ… æ­£ç¡®åšæ³•
```typescript
// lib/utils/index.ts - ç»Ÿä¸€å®šä¹‰
export const formatCurrency = (amount: number): string => {
  return new Intl.NumberFormat('zh-CN', {
    style: 'currency',
    currency: 'CNY'
  }).format(amount);
};

// å…¶ä»–æ–‡ä»¶ä¸­ä½¿ç”¨
import { formatCurrency } from '@/lib/utils';
```

### 2. éªŒè¯å‡½æ•°å†—ä½™

#### âŒ é”™è¯¯åšæ³•
```typescript
// åœ¨å¤šä¸ªæ–‡ä»¶ä¸­é‡å¤å®šä¹‰ç›¸åŒçš„éªŒè¯é€»è¾‘
const validateEmail = (email: string) => {
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  return emailRegex.test(email);
};
```

#### âœ… æ­£ç¡®åšæ³•
```typescript
// lib/utils/validation-helpers.ts - ç»Ÿä¸€å®šä¹‰
export const validateEmail = (email: string): boolean => {
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  return emailRegex.test(email);
};

// ä½¿ç”¨æ—¶å¯¼å…¥
import { validateEmail } from '@/lib/utils/validation-helpers';
```

### 3. é”™è¯¯æ¶ˆæ¯å†—ä½™

#### âŒ é”™è¯¯åšæ³•
```typescript
// åœ¨å¤šä¸ªAPIæ–‡ä»¶ä¸­é‡å¤å®šä¹‰
return NextResponse.json(
  { success: false, error: 'æœªæˆæƒè®¿é—®' },
  { status: 401 }
);
```

#### âœ… æ­£ç¡®åšæ³•
```typescript
// lib/constants/error-messages.ts - ç»Ÿä¸€å®šä¹‰
export const API_ERROR_MESSAGES = {
  UNAUTHORIZED: 'æœªæˆæƒè®¿é—®',
  INVALID_INPUT: 'è¾“å…¥æ•°æ®æ ¼å¼ä¸æ­£ç¡®',
  // ...
} as const;

// APIæ–‡ä»¶ä¸­ä½¿ç”¨
import { API_ERROR_MESSAGES } from '@/lib/constants/error-messages';
return NextResponse.json(
  { success: false, error: API_ERROR_MESSAGES.UNAUTHORIZED },
  { status: 401 }
);
```

### 4. æ ·å¼ç±»åå†—ä½™

#### âŒ é”™è¯¯åšæ³•
```tsx
// åœ¨å¤šä¸ªç»„ä»¶ä¸­é‡å¤ä½¿ç”¨ç›¸åŒçš„æ ·å¼ç»„åˆ
<div className="flex items-center gap-2">
<div className="flex items-center justify-between">
<div className="grid grid-cols-1 md:grid-cols-2 gap-4">
```

#### âœ… æ­£ç¡®åšæ³•
```typescript
// lib/utils/style-classes.ts - ç»Ÿä¸€å®šä¹‰
export const layoutStyles = {
  flexGap2: 'flex items-center gap-2',
  flexBetween: 'flex items-center justify-between',
  gridResponsive: 'grid grid-cols-1 md:grid-cols-2 gap-4',
} as const;

// ç»„ä»¶ä¸­ä½¿ç”¨
import { layoutStyles } from '@/lib/utils/style-classes';
<div className={layoutStyles.flexGap2}>
```

## ğŸ” ä»£ç å®¡æŸ¥æ£€æŸ¥ç‚¹

### Pull Request å®¡æŸ¥æ¸…å•

#### 1. å‡½æ•°é‡å¤æ£€æŸ¥
- [ ] æ–°å¢å‡½æ•°æ˜¯å¦å·²åœ¨é¡¹ç›®ä¸­å­˜åœ¨ç±»ä¼¼å®ç°ï¼Ÿ
- [ ] æ˜¯å¦æ”¾åœ¨äº†æ­£ç¡®çš„å·¥å…·å‡½æ•°æ–‡ä»¶ä¸­ï¼Ÿ
- [ ] æ˜¯å¦æœ‰å®Œæ•´çš„TypeScriptç±»å‹å®šä¹‰ï¼Ÿ

#### 2. å¸¸é‡é‡å¤æ£€æŸ¥
- [ ] ç¡¬ç¼–ç å­—ç¬¦ä¸²æ˜¯å¦åº”è¯¥æå–ä¸ºå¸¸é‡ï¼Ÿ
- [ ] æ–°å¢å¸¸é‡æ˜¯å¦å·²åœ¨å¸¸é‡æ–‡ä»¶ä¸­å­˜åœ¨ï¼Ÿ
- [ ] æ˜¯å¦ä½¿ç”¨äº†æ­£ç¡®çš„å¸¸é‡å¯¼å…¥ï¼Ÿ

#### 3. æ ·å¼é‡å¤æ£€æŸ¥
- [ ] æ˜¯å¦ä½¿ç”¨äº†é‡å¤çš„æ ·å¼ç±»åç»„åˆï¼Ÿ
- [ ] æ˜¯å¦å¯ä»¥ä½¿ç”¨é¢„å®šä¹‰çš„æ ·å¼å·¥å…·ç±»ï¼Ÿ
- [ ] æ–°å¢æ ·å¼æ˜¯å¦åº”è¯¥æ·»åŠ åˆ°æ ·å¼å·¥å…·åº“ï¼Ÿ

#### 4. å¯¼å…¥æ£€æŸ¥
- [ ] æ˜¯å¦ä»æ­£ç¡®çš„æ¨¡å—å¯¼å…¥å·¥å…·å‡½æ•°ï¼Ÿ
- [ ] æ˜¯å¦æœ‰æœªä½¿ç”¨çš„å¯¼å…¥ï¼Ÿ
- [ ] å¯¼å…¥è·¯å¾„æ˜¯å¦ä½¿ç”¨äº†åˆ«åï¼ˆ@/ï¼‰ï¼Ÿ

## ğŸ›¡ï¸ è‡ªåŠ¨åŒ–æ£€æŸ¥å·¥å…·

### 1. å†—ä½™å‡½æ•°æ£€æŸ¥
```bash
# è¿è¡Œå†—ä½™å‡½æ•°æ£€æŸ¥
npx tsx scripts/check-redundant-functions.ts
```

### 2. TypeScript ç±»å‹æ£€æŸ¥
```bash
# ç¡®ä¿æ²¡æœ‰ç±»å‹é”™è¯¯
npx tsc --noEmit --skipLibCheck
```

### 3. ESLint ä»£ç è´¨é‡æ£€æŸ¥
```bash
# æ£€æŸ¥ä»£ç è´¨é‡é—®é¢˜
npx eslint . --ext .ts,.tsx
```

## ğŸ“š æœ€ä½³å®è·µç¤ºä¾‹

### 1. åˆ›å»ºæ–°çš„å·¥å…·å‡½æ•°
```typescript
// 1. å…ˆæ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
// 2. ç¡®å®šæ”¾ç½®ä½ç½®
// 3. æ·»åŠ å®Œæ•´ç±»å‹å®šä¹‰
// 4. ç¼–å†™å•å…ƒæµ‹è¯•

// lib/utils/string-helpers.ts
export const capitalizeFirst = (str: string): string => {
  if (!str) return str;
  return str.charAt(0).toUpperCase() + str.slice(1);
};

// å¯¼å‡ºåˆ°ä¸»å·¥å…·æ–‡ä»¶
// lib/utils/index.ts
export { capitalizeFirst } from './string-helpers';
```

### 2. æ·»åŠ æ–°çš„å¸¸é‡
```typescript
// 1. ç¡®å®šå¸¸é‡ç±»å‹å’Œç”¨é€”
// 2. æ”¾å…¥å¯¹åº”çš„å¸¸é‡æ–‡ä»¶
// 3. æ·»åŠ ç±»å‹å¯¼å‡º

// lib/constants/business-status.ts
export const ORDER_STATUS = {
  PENDING: 'pending',
  CONFIRMED: 'confirmed',
  SHIPPED: 'shipped',
  DELIVERED: 'delivered',
} as const;

export type OrderStatus = typeof ORDER_STATUS[keyof typeof ORDER_STATUS];
```

## ğŸ¯ å›¢é˜Ÿåä½œè§„èŒƒ

### 1. ä»£ç æäº¤å‰
- è¿è¡Œè‡ªåŠ¨åŒ–æ£€æŸ¥å·¥å…·
- ç¡®ä¿TypeScriptç¼–è¯‘é€šè¿‡
- æ£€æŸ¥æ˜¯å¦å¼•å…¥äº†æ–°çš„å†—ä½™

### 2. ä»£ç å®¡æŸ¥æ—¶
- é‡ç‚¹å…³æ³¨æ˜¯å¦æœ‰é‡å¤å®ç°
- æ£€æŸ¥æ˜¯å¦éµå¾ªäº†é¡¹ç›®ç»“æ„è§„èŒƒ
- ç¡®è®¤æ–°å¢ä»£ç çš„å¿…è¦æ€§

### 3. å®šæœŸç»´æŠ¤
- æ¯æœˆè¿è¡Œå†—ä½™æ£€æŸ¥å·¥å…·
- åŠæ—¶æ¸…ç†å‘ç°çš„å†—ä½™ä»£ç 
- æ›´æ–°å’Œå®Œå–„å·¥å…·å‡½æ•°åº“

## ğŸ“ˆ æŒç»­æ”¹è¿›

### 1. ç›‘æ§æŒ‡æ ‡
- å†—ä½™å‡½æ•°æ•°é‡
- é‡å¤å¸¸é‡æ•°é‡
- ä»£ç é‡å¤ç‡

### 2. å·¥å…·å®Œå–„
- æ‰©å±•è‡ªåŠ¨åŒ–æ£€æŸ¥è¦†ç›–èŒƒå›´
- é›†æˆåˆ°CI/CDæµç¨‹
- å¼€å‘IDEæ’ä»¶æé†’

### 3. å›¢é˜ŸåŸ¹è®­
- å®šæœŸåˆ†äº«æœ€ä½³å®è·µ
- æ–°äººå…¥èŒåŸ¹è®­
- ä»£ç å®¡æŸ¥ç»éªŒåˆ†äº«

## ğŸ”§ é›†æˆåˆ°å¼€å‘æµç¨‹

### 1. Git Hooks é›†æˆ
```bash
# å®‰è£… pre-commit hook
cp scripts/pre-commit-quality-check.ts .git/hooks/pre-commit
chmod +x .git/hooks/pre-commit
```

### 2. VS Code é…ç½®
```json
// .vscode/settings.json
{
  "typescript.preferences.includePackageJsonAutoImports": "on",
  "typescript.suggest.autoImports": true,
  "editor.codeActionsOnSave": {
    "source.organizeImports": true,
    "source.fixAll.eslint": true
  }
}
```

### 3. å¿«æ·å‘½ä»¤
```json
// package.json scripts
{
  "scripts": {
    "check:redundant": "tsx scripts/check-redundant-functions.ts",
    "check:quality": "tsx scripts/pre-commit-quality-check.ts",
    "fix:imports": "tsx scripts/fix-imports.ts"
  }
}
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å¼€å‘å¿«é€Ÿå‚è€ƒå¡](./å¼€å‘å¿«é€Ÿå‚è€ƒå¡.md) - æ—¥å¸¸å¼€å‘é€ŸæŸ¥æ‰‹å†Œ
- [æœ€ç»ˆå†—ä½™ä»£ç æ£€æŸ¥æŠ¥å‘Š](./æœ€ç»ˆå†—ä½™ä»£ç æ£€æŸ¥æŠ¥å‘Š.md) - é¡¹ç›®å†—ä½™æ¸…ç†æ€»ç»“
- [å…¨æ ˆé¡¹ç›®ç»Ÿä¸€çº¦å®šè§„èŒƒ](../.augment/rules/å…¨æ ˆé¡¹ç›®ç»Ÿä¸€çº¦å®šè§„èŒƒ.md) - é¡¹ç›®æ•´ä½“è§„èŒƒ

---

**è®°ä½ï¼šé¢„é˜²èƒœäºæ²»ç–—ã€‚éµå¾ªè¿™äº›è§„èŒƒï¼Œä»æºå¤´é¿å…å†—ä½™ä»£ç çš„äº§ç”Ÿï¼Œæ¯”äº‹åæ¸…ç†æ›´åŠ é«˜æ•ˆï¼**
