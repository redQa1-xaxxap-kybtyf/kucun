# 库存管理工具 - 需求共识文档

## 1. 项目概述

### 1.1 项目目标

专为瓷砖行业设计的库存管理工具，支持销售、入库、客户管理等核心功能，提供移动端友好的操作体验。

### 1.2 核心价值

- 简化瓷砖行业的库存管理流程
- 支持色号等行业特有属性管理
- 提供移动端便捷操作
- 实现销售和库存的一体化管理

## 2. 技术架构

### 2.1 技术栈

- **全栈框架**: Next.js 15.4 (App Router) + TypeScript 5.2
- **数据库**: MySQL 8.0+
- **数据库驱动**: Prisma
- **身份认证**: Next-Auth.js
- **状态管理**: TanStack Query v5.79.0
- **UI组件库**: Tailwind CSS v4.1.12 + shadcn/ui 2025.1.2
- **表单处理**: React Hook Form 7.54.1
- **数据验证**: Zod 4.0
- **单位转换**: convert-units 4.0.0
- **文件上传**: multer
- **图片处理**: sharp
- **代码质量工具**: ESLint 9 + Prettier + Husky
- **环境管理**: .env.local 文件
- **服务器管理**: 宝塔面板

### 2.2 架构特点

- 全栈TypeScript开发，确保类型安全
- Next.js 15.4 App Router，现代化路由系统
- MySQL + Prisma，类型安全的数据库操作
- TanStack Query，专业的服务端状态管理
- 移动端响应式设计，支持触屏操作
- 图片生成单据功能，便于分享和存档
- 基于角色的权限控制系统
- 完整的代码质量工具链，确保代码规范

## 3. 功能模块需求

### 3.1 用户角色管理

| 角色   | 注册方式   | 核心权限                             |
| ------ | ---------- | ------------------------------------ |
| 管理员 | 系统预设   | 全部功能权限，查看所有数据           |
| 销售员 | 管理员创建 | 创建销售单，查看自己的数据，确认收款 |

### 3.2 价格策略

- 基于历史价格的自动填充机制
- 每个客户记录最后一次开票价格
- 新建销售单时自动带出历史价格
- ❌ 不支持多级价格体系、优惠折扣计算

### 3.3 库存管理

- 支持产品基础信息管理（编号、名称、规格、单位等）
- 瓷砖行业特有属性：色号、生产日期、每件片数、重量
- 库存预警功能：低于阈值时在仪表盘显示
- 不允许负库存销售，库存不足时禁止销售并显示警告提示
- ❌ 不需要批量折扣、促销价格、盘点功能、邮件提醒

### 3.4 移动端功能

- 移动端友好的响应式界面设计
- 支持触屏操作和手势导航
- 移动端销售单创建和管理
- 移动端库存查询和入库操作

### 3.5 色号展示

- 色号作为产品的重要属性进行管理
- 在产品列表、销售单、入库单中显示色号信息
- 支持按色号搜索和筛选产品

## 4. 边界条件和约束

### 4.1 功能边界

- 单租户系统，不支持多租户
- 专注瓷砖行业，支持色号管理
- 移动端友好，支持触屏操作
- 图片生成单据，不支持打印
- 不需要第三方系统集成（财务软件、ERP等）
- 不需要API接口提供和数据同步
- 不需要在线支付功能

### 4.2 技术约束

- **严格遵循技术栈**：必须使用已确定的技术栈（Next.js 15.4、MySQL 8.0+、Prisma、TanStack Query等），禁止偏离或替换
- **禁止重复造轮子**：严禁自定义实现已有成熟库的功能，必须使用现有成熟的库和组件
- **复用现有组件**：优先使用shadcn/ui组件库，避免自定义UI组件
- **必须支持移动端响应式**：使用Tailwind CSS响应式设计
- **严格使用TypeScript**：确保类型安全，禁止使用any类型

### 4.3 业务约束

- 不允许负库存销售，严格库存控制
- 已审核订单不可修改
- 价格策略简化，不支持复杂折扣

## 5. 验收标准

### 5.1 功能验收

- 用户角色权限正确实现
- 价格复用机制正常工作
- 库存预警功能正常
- 色号管理功能完整
- 移动端操作流畅
- 单据图片生成正常

### 5.2 技术验收

- 系统架构符合设计
- 代码质量达标
- 性能指标满足要求
- 安全性验证通过

### 5.3 性能标准

- 页面加载时间 < 3秒
- API响应时间 < 500ms
- 支持50个并发用户
- 支持10万级产品数据

## 6. 核心业务流程

### 6.1 销售流程

1. 创建销售单：录入客户信息和产品信息
2. 系统自动填充历史价格
3. 库存检查：验证库存是否充足，不足时禁止提交
4. 审核确认：管理员或销售员审核
5. 自动出库：审核通过后立即扣减库存
6. 发货确认：标记发货状态
7. 收款管理：记录收款状态和金额

### 6.2 库存管理流程

1. 入库操作：直接填写入库单，系统自动更新库存
2. 退货处理：通过入库单处理，显示退款金额
3. 库存调整：支持手动调整库存数量，记录调整原因
4. 库存预警：低于阈值时在仪表盘显示警告

## 7. 技术实现要点

### 7.1 数据库设计

- 用户表：存储用户角色和权限信息
- 产品表：产品基础信息和库存数量
- 客户表：客户基础信息
- 销售单表：销售单据主表
- 销售明细表：销售单据明细
- 入库单表：入库单据
- 收款记录表：收款明细记录

### 7.2 关键技术点

- **严格技术栈执行**：必须使用TanStack Query进行状态管理，禁止使用其他状态管理库
- **组件复用原则**：优先使用shadcn/ui组件，禁止重复开发已有组件
- **数据库操作**：严格使用Prisma ORM，禁止直接SQL操作或其他ORM
- **缓存系统**：使用Redis缓存提升性能，缓存热点数据和查询结果
- **表单处理**：必须使用React Hook Form + Zod，禁止自定义表单验证
- **文件处理**：使用multer + sharp，禁止自定义文件处理逻辑
- **样式系统**：严格使用Tailwind CSS，禁止自定义CSS框架
- **TypeScript规范**：确保类型安全，使用Prisma生成的类型定义

## 8. 项目总结

本文档明确了库存管理工具的核心需求和技术方案：

- 专注瓷砖行业的库存管理
- 支持销售、入库、客户管理等核心功能
- 移动端友好的响应式设计
- 简化的业务流程，避免过度复杂
- 明确的技术栈和架构约束

所有需求边界已确认，可以进入下一阶段的架构设计和开发实施。
