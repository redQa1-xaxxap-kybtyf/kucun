# 单据字段汇总确认文档

## 1. 销售单字段设计

### 1.1 必填字段

| 字段名称 | 字段类型      | 验证规则                      | 说明             |
| -------- | ------------- | ----------------------------- | ---------------- |
| 客户姓名 | VARCHAR(50)   | 必填，最大50字符              | 客户基本信息     |
| 产品编号 | VARCHAR(50)   | 必填，必须存在于产品表        | 关联产品信息     |
| 产品规格 | VARCHAR(100)  | 必填                          | 产品规格描述     |
| 色号     | VARCHAR(20)   | 必填                          | 瓷砖行业特有字段 |
| 销售数量 | DECIMAL(10,2) | 必填，最小0.01，最大999999.99 | 支持小数         |
| 单价     | DECIMAL(10,2) | 必填，最小0，最大999999.99    | 支持小数         |
| 销售日期 | DATETIME      | 系统自动生成，可修改          | 订单创建时间     |

### 1.2 可选字段

| 字段名称   | 字段类型    | 验证规则             | 说明     |
| ---------- | ----------- | -------------------- | -------- |
| 客户手机号 | VARCHAR(11) | 可选，手机号格式验证 | 推荐填写 |

| 订单备注 | TEXT | 可选，最大500字符 | 特殊说明 |
| 销售员 | INT | 自动填充当前用户，管理员可修改 | 关联用户表 |

### 1.3 系统计算字段

| 字段名称 | 字段类型      | 计算规则                                | 说明             |
| -------- | ------------- | --------------------------------------- | ---------------- |
| 总金额   | DECIMAL(10,2) | 数量 × 单价                             | 实时计算         |
| 总片数   | DECIMAL(10,2) | 销售数量 × 每件片数                     | 根据产品信息计算 |
| 订单状态 | ENUM          | 草稿/待审核/已审核/已发货/已完成/已取消 | 状态流转         |
| 收款状态 | ENUM          | 未收款/部分收款/已收款                  | 收款管理         |

## 2. 入库单字段设计

### 2.1 必填字段

| 字段名称 | 字段类型      | 验证规则                         | 说明           |
| -------- | ------------- | -------------------------------- | -------------- |
| 产品编号 | VARCHAR(50)   | 必填，支持新建产品               | 可在入库时创建 |
| 产品规格 | VARCHAR(100)  | 必填                             | 产品规格描述   |
| 每件片数 | INT           | 必填，大于0                      | 瓷砖行业特有   |
| 入库数量 | DECIMAL(10,2) | 必填，大于0                      | 支持小数       |
| 单位     | ENUM          | 必填，件/片/条                   | 计量单位       |
| 入库日期 | DATETIME      | 系统自动生成                     | 入库时间       |
| 入库类型 | ENUM          | 必填，正常入库/退货入库/调整入库 | 业务类型       |

### 2.2 产品属性字段

| 字段名称 | 字段类型     | 验证规则 | 说明         |
| -------- | ------------ | -------- | ------------ |
| 色号     | VARCHAR(20)  | 必填     | 瓷砖行业特有 |
| 生产日期 | DATE         | 必填     | 产品生产时间 |
| 重量     | DECIMAL(8,2) | 可选     | 产品重量     |

### 2.3 可选字段

| 字段名称 | 字段类型     | 验证规则          | 说明     |
| -------- | ------------ | ----------------- | -------- |
| 产品名称 | VARCHAR(100) | 可选              | 产品名称 |
| 备注信息 | TEXT         | 可选，最大500字符 | 特殊说明 |

### 2.4 系统字段

| 字段名称 | 字段类型      | 计算规则     | 说明                 |
| -------- | ------------- | ------------ | -------------------- |
| 入库单号 | VARCHAR(20)   | 自动生成     | RK/TH/TZ+日期+流水号 |
| 库存数量 | DECIMAL(10,2) | 系统计算     | 入库后库存总量       |
| 创建人   | INT           | 当前登录用户 | 关联用户表           |
| 创建时间 | DATETIME      | 系统时间     | 记录创建时间         |

## 3. 退货单字段设计

### 3.1 必填字段

| 字段名称     | 字段类型      | 验证规则               | 说明                         |
| ------------ | ------------- | ---------------------- | ---------------------------- |
| 退货单号     | VARCHAR(20)   | 自动生成               | TH+日期+流水号               |
| 关联销售单号 | VARCHAR(20)   | 必填，必须存在         | 原销售单据                   |
| 退货产品     | JSON          | 必填                   | 退货明细列表                 |
| 退货数量     | DECIMAL(10,2) | 必填，不超过原销售数量 | 每个产品的退货数量           |
| 退货原因     | VARCHAR(200)  | 必填                   | 质量问题/客户要求/尺寸不符等 |
| 退货类型     | ENUM          | 必填，换货/退款/维修   | 处理方式                     |

### 3.2 可选字段

| 字段名称 | 字段类型 | 验证规则          | 说明         |
| -------- | -------- | ----------------- | ------------ |
| 退货说明 | TEXT     | 可选，最大500字符 | 详细说明     |
| 处理备注 | TEXT     | 可选，最大300字符 | 处理过程记录 |

### 3.3 系统字段

| 字段名称 | 字段类型      | 计算规则                         | 说明     |
| -------- | ------------- | -------------------------------- | -------- |
| 退货状态 | ENUM          | 草稿/待审核/已审核/已完成/已拒绝 | 状态流转 |
| 退款金额 | DECIMAL(10,2) | 退货数量 × 原销售单价            | 自动计算 |
| 退款状态 | ENUM          | 未退款/已退款/逾期退款           | 退款管理 |
| 创建人   | INT           | 当前登录用户                     | 销售员   |
| 审核人   | INT           | 审核通过的管理员                 | 管理员   |
| 创建时间 | DATETIME      | 系统时间                         | 创建时间 |
| 审核时间 | DATETIME      | 审核通过时间                     | 审核时间 |

## 4. 收款记录字段设计

### 4.1 必填字段

| 字段名称   | 字段类型      | 验证规则        | 说明         |
| ---------- | ------------- | --------------- | ------------ |
| 关联订单号 | VARCHAR(20)   | 必填，销售单号  | 关联销售单   |
| 收款金额   | DECIMAL(10,2) | 必填，大于0     | 本次收款金额 |
| 收款方式   | ENUM          | 必填，现金/扫码 | 收款方式     |
| 收款时间   | DATETIME      | 必填            | 实际收款时间 |
| 操作人     | INT           | 必填            | 收款操作员   |

### 4.2 可选字段

| 字段名称   | 字段类型    | 验证规则          | 说明             |
| ---------- | ----------- | ----------------- | ---------------- |
| 备注信息   | TEXT        | 可选，最大300字符 | 收款备注         |
| 交易流水号 | VARCHAR(50) | 可选              | 第三方支付流水号 |

### 4.3 系统字段

| 字段名称   | 字段类型 | 计算规则 | 说明         |
| ---------- | -------- | -------- | ------------ |
| 收款记录ID | INT      | 自增主键 | 唯一标识     |
| 收款状态   | ENUM     | 已确认   | 简化状态管理 |
| 创建时间   | DATETIME | 系统时间 | 记录创建时间 |

## 5. 字段验证规则汇总

### 5.1 通用验证规则

- **必填字段**：不能为空或null
- **数值字段**：必须为有效数字，支持小数点后2位
- **日期字段**：必须为有效日期格式
- **枚举字段**：必须在预定义值范围内
- **长度限制**：严格按照字段定义的最大长度

### 5.2 业务逻辑验证

- **库存验证**：销售时检查库存，允许负库存但给出提示
- **数量验证**：退货数量不能超过原销售数量
- **价格验证**：价格必须为非负数
- **关联验证**：外键关联必须存在对应记录

### 5.3 数据完整性约束

- **唯一性约束**：单据编号、客户手机号等
- **外键约束**：使用逻辑外键，不使用物理外键
- **索引优化**：为常用查询字段创建索引

## 6. 确认清单

### 6.1 销售单字段确认 ✅

- [x] 必填字段：客户姓名、产品信息、数量、单价
- [x] 可选字段：手机号、备注
- [x] 系统字段：总金额、状态、时间戳
- [x] 验证规则：数值范围、格式验证

### 6.2 入库单字段确认 ✅

- [x] 必填字段：产品信息、数量、单位、类型
- [x] 产品属性：色号、生产日期、重量
- [x] 可选字段：产品名称、备注
- [x] 系统字段：单据编号、库存计算

### 6.3 退货单字段确认 ✅

- [x] 必填字段：关联销售单、退货明细、原因、类型
- [x] 可选字段：详细说明、处理备注
- [x] 系统字段：状态管理、金额计算
- [x] 业务规则：数量限制、审核流程

### 6.4 收款记录字段确认 ✅

- [x] 必填字段：订单号、金额、方式、时间、操作人
- [x] 可选字段：备注、流水号
- [x] 系统字段：状态、时间戳
- [x] 简化设计：移除凭证上传功能

## 7. 技术实现要点

### 7.1 数据库设计

- 使用MySQL数据库
- 字段类型严格按照业务需求定义
- 创建必要的索引提升查询性能
- 使用逻辑外键而非物理外键

### 7.2 前端验证

- 实时字段验证，提升用户体验
- 统一的错误提示信息
- 移动端适配的输入组件

### 7.3 后端验证

- 双重验证确保数据安全
- 统一的验证规则管理
- 详细的错误日志记录

---

**文档状态**：已确认 ✅  
**最后更新**：2024年12月25日  
**确认人**：系统架构师  
**版本**：v1.0
