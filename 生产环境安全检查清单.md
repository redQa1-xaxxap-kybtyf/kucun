# ç”Ÿäº§ç¯å¢ƒå®‰å…¨æ£€æŸ¥æ¸…å•

> ç‰ˆæœ¬: 1.0.0
> æ›´æ–°æ—¶é—´: 2025-10-02
> ç”¨é€”: ç¡®ä¿ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²çš„å®‰å…¨æ€§

---

## ğŸ”´ ç¬¬ä¸€ä¼˜å…ˆçº§: ä¸¥é‡å®‰å…¨é—®é¢˜ (å¿…é¡»å®Œæˆ)

### 1. èº«ä»½éªŒè¯å’Œæˆæƒ

- [ ] **ç§»é™¤å¼€å‘ç¯å¢ƒè®¤è¯ç»•è¿‡**
  - æ–‡ä»¶: `lib/api/middleware.ts`
  - éªŒè¯: ç¡®è®¤æ²¡æœ‰ `if (env.NODE_ENV === 'development')` ç»•è¿‡é€»è¾‘
  - çŠ¶æ€: âœ… å·²å®Œæˆ

- [ ] **æ‰€æœ‰ API è·¯ç”±éœ€è¦èº«ä»½éªŒè¯**
  - éªŒè¯æ–¹æ³•: 
    ```bash
    # æµ‹è¯•æœªç™»å½•è®¿é—® API
    curl -I https://your-domain.com/api/products
    # åº”è¯¥è¿”å› 401 Unauthorized
    ```
  - çŠ¶æ€: â³ å¾…éªŒè¯

- [ ] **ä¼šè¯ç®¡ç†æ­£ç¡®é…ç½®**
  - æ£€æŸ¥ `NEXTAUTH_SECRET` å·²è®¾ç½®ä¸ºå¼ºå¯†é’¥
  - æ£€æŸ¥ `NEXTAUTH_URL` è®¾ç½®ä¸ºæ­£ç¡®çš„ç”Ÿäº§åŸŸå
  - éªŒè¯ä¼šè¯è¿‡æœŸæ—¶é—´åˆç† (é»˜è®¤ 90 å¤©)
  - çŠ¶æ€: â³ å¾…é…ç½®

### 2. å®‰å…¨å“åº”å¤´

- [ ] **Content Security Policy (CSP) å·²é…ç½®**
  - æ–‡ä»¶: `middleware.ts`
  - éªŒè¯æ–¹æ³•:
    ```bash
    curl -I https://your-domain.com | grep "Content-Security-Policy"
    ```
  - é¢„æœŸ: åº”è¯¥çœ‹åˆ° CSP å¤´
  - çŠ¶æ€: âœ… å·²å®Œæˆ

- [ ] **å…¶ä»–å®‰å…¨å¤´å·²é…ç½®**
  - X-Content-Type-Options: nosniff
  - X-Frame-Options: DENY
  - X-XSS-Protection: 1; mode=block
  - Referrer-Policy: strict-origin-when-cross-origin
  - Permissions-Policy: camera=(), microphone=(), geolocation=()
  - éªŒè¯æ–¹æ³•:
    ```bash
    curl -I https://your-domain.com | grep -E "(X-Content-Type-Options|X-Frame-Options|X-XSS-Protection|Referrer-Policy|Permissions-Policy)"
    ```
  - çŠ¶æ€: âœ… å·²å®Œæˆ

### 3. å¯†é’¥å’Œæ•æ„Ÿä¿¡æ¯

- [ ] **NEXTAUTH_SECRET å·²æ›´æ–°**
  - ä½¿ç”¨ `openssl rand -base64 32` ç”Ÿæˆ
  - è‡³å°‘ 32 å­—ç¬¦
  - ä¸æ˜¯å¼€å‘ç¯å¢ƒçš„é»˜è®¤å€¼
  - çŠ¶æ€: â³ å¾…ç”Ÿæˆ

- [ ] **STORAGE_ENCRYPTION_KEY å·²æ›´æ–°**
  - ä½¿ç”¨ `openssl rand -base64 32` ç”Ÿæˆ
  - è‡³å°‘ 32 å­—ç¬¦
  - ä¸æ˜¯å¼€å‘ç¯å¢ƒçš„é»˜è®¤å€¼
  - çŠ¶æ€: â³ å¾…ç”Ÿæˆ

- [ ] **æ•°æ®åº“å¯†ç å¼ºåº¦**
  - è‡³å°‘ 16 å­—ç¬¦
  - åŒ…å«å¤§å°å†™å­—æ¯ã€æ•°å­—ã€ç‰¹æ®Šå­—ç¬¦
  - ä¸æ˜¯é»˜è®¤å¯†ç 
  - çŠ¶æ€: â³ å¾…é…ç½®

- [ ] **Redis å¯†ç å·²é…ç½®**
  - åœ¨ `/etc/redis/redis.conf` ä¸­è®¾ç½® `requirepass`
  - æ›´æ–° `REDIS_URL` åŒ…å«å¯†ç 
  - çŠ¶æ€: â³ å¾…é…ç½®

- [ ] **.env.production æœªæäº¤åˆ° Git**
  - éªŒè¯æ–¹æ³•:
    ```bash
    git check-ignore .env.production
    # åº”è¯¥è¾“å‡º: .env.production
    
    git ls-files | grep ".env.production"
    # åº”è¯¥æ²¡æœ‰è¾“å‡º
    ```
  - çŠ¶æ€: â³ å¾…éªŒè¯

### 4. SSL/HTTPS é…ç½®

- [ ] **SSL è¯ä¹¦å·²å®‰è£…**
  - ä½¿ç”¨ Let's Encrypt æˆ–å…¶ä»– CA
  - è¯ä¹¦æœ‰æ•ˆæœŸ > 30 å¤©
  - çŠ¶æ€: â³ å¾…é…ç½®

- [ ] **å¼ºåˆ¶ HTTPS**
  - HTTP è‡ªåŠ¨é‡å®šå‘åˆ° HTTPS
  - éªŒè¯æ–¹æ³•:
    ```bash
    curl -I http://your-domain.com
    # åº”è¯¥è¿”å› 301 é‡å®šå‘åˆ° https://
    ```
  - çŠ¶æ€: â³ å¾…é…ç½®

- [ ] **HSTS å·²å¯ç”¨**
  - Strict-Transport-Security å¤´å·²è®¾ç½®
  - éªŒè¯æ–¹æ³•:
    ```bash
    curl -I https://your-domain.com | grep "Strict-Transport-Security"
    ```
  - çŠ¶æ€: â³ å¾…éªŒè¯

- [ ] **SSL é…ç½®è¯„åˆ†**
  - è®¿é—®: https://www.ssllabs.com/ssltest/
  - ç›®æ ‡è¯„åˆ†: A æˆ– A+
  - çŠ¶æ€: â³ å¾…æµ‹è¯•

### 5. æ•°æ®åº“å®‰å…¨

- [ ] **æ•°æ®åº“è¿æ¥ä½¿ç”¨ SSL**
  - åœ¨ `DATABASE_URL` ä¸­æ·»åŠ  `?ssl=true`
  - çŠ¶æ€: â³ å¾…é…ç½®

- [ ] **æ•°æ®åº“ç”¨æˆ·æƒé™æœ€å°åŒ–**
  - åªæˆäºˆå¿…è¦çš„æƒé™ (SELECT, INSERT, UPDATE, DELETE)
  - ä¸æˆäºˆ DROP, CREATE USER ç­‰å±é™©æƒé™
  - çŠ¶æ€: â³ å¾…é…ç½®

- [ ] **æ•°æ®åº“å¤‡ä»½å·²é…ç½®**
  - æ¯æ—¥è‡ªåŠ¨å¤‡ä»½
  - å¤‡ä»½æ–‡ä»¶åŠ å¯†å­˜å‚¨
  - å®šæœŸæµ‹è¯•æ¢å¤
  - çŠ¶æ€: â³ å¾…é…ç½®

---

## ğŸŸ¡ ç¬¬äºŒä¼˜å…ˆçº§: é‡è¦å®‰å…¨é…ç½® (å¼ºçƒˆå»ºè®®)

### 6. æ–‡ä»¶ä¸Šä¼ å®‰å…¨

- [ ] **æ–‡ä»¶ç±»å‹éªŒè¯**
  - æ£€æŸ¥ `STORAGE_ALLOWED_FILE_TYPES` é…ç½®
  - åªå…è®¸å¿…è¦çš„æ–‡ä»¶ç±»å‹
  - çŠ¶æ€: â³ å¾…éªŒè¯

- [ ] **æ–‡ä»¶å¤§å°é™åˆ¶**
  - æ£€æŸ¥ `UPLOAD_MAX_SIZE` é…ç½®
  - é»˜è®¤ 10MB,æ ¹æ®éœ€æ±‚è°ƒæ•´
  - çŠ¶æ€: â³ å¾…éªŒè¯

- [ ] **ä¸Šä¼ ç›®å½•æƒé™**
  - ä¸Šä¼ ç›®å½•ä¸å¯æ‰§è¡Œ
  - éªŒè¯æ–¹æ³•:
    ```bash
    ls -ld /var/www/uploads
    # åº”è¯¥æ˜¯ 755 æˆ– 750,ä¸æ˜¯ 777
    ```
  - çŠ¶æ€: â³ å¾…é…ç½®

### 7. æ—¥å¿—å’Œç›‘æ§

- [ ] **æ•æ„Ÿä¿¡æ¯ä¸è®°å½•åˆ°æ—¥å¿—**
  - å¯†ç ã€å¯†é’¥ã€Token ä¸å‡ºç°åœ¨æ—¥å¿—ä¸­
  - æ£€æŸ¥ `logs/` ç›®å½•
  - çŠ¶æ€: â³ å¾…éªŒè¯

- [ ] **æ—¥å¿—çº§åˆ«æ­£ç¡®é…ç½®**
  - ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ `LOG_LEVEL=warn` æˆ– `error`
  - ä¸ä½¿ç”¨ `debug` æˆ– `info`
  - çŠ¶æ€: â³ å¾…é…ç½®

- [ ] **æ—¥å¿—è½®è½¬å·²é…ç½®**
  - é˜²æ­¢æ—¥å¿—æ–‡ä»¶è¿‡å¤§
  - è‡ªåŠ¨æ¸…ç†æ—§æ—¥å¿—
  - çŠ¶æ€: â³ å¾…é…ç½®

- [ ] **é”™è¯¯ç›‘æ§å·²é›†æˆ**
  - æ¨è: Sentry
  - å®æ—¶é”™è¯¯é€šçŸ¥
  - çŠ¶æ€: â³ å¾…é›†æˆ

### 8. ç½‘ç»œå®‰å…¨

- [ ] **é˜²ç«å¢™å·²é…ç½®**
  - åªå¼€æ”¾å¿…è¦ç«¯å£ (80, 443, 22)
  - æ•°æ®åº“ç«¯å£ (3306) ä¸å¯¹å¤–å¼€æ”¾
  - Redis ç«¯å£ (6379) ä¸å¯¹å¤–å¼€æ”¾
  - éªŒè¯æ–¹æ³•:
    ```bash
    sudo ufw status
    ```
  - çŠ¶æ€: â³ å¾…é…ç½®

- [ ] **SSH å®‰å…¨é…ç½®**
  - ç¦ç”¨ root ç™»å½•
  - ä½¿ç”¨å¯†é’¥è®¤è¯
  - ä¿®æ”¹é»˜è®¤ç«¯å£ (å¯é€‰)
  - çŠ¶æ€: â³ å¾…é…ç½®

- [ ] **DDoS é˜²æŠ¤**
  - ä½¿ç”¨ Cloudflare æˆ–å…¶ä»– CDN
  - é…ç½®é€Ÿç‡é™åˆ¶
  - çŠ¶æ€: â³ å¾…é…ç½®

### 9. ä¾èµ–å®‰å…¨

- [ ] **ä¾èµ–åŒ…å·²æ›´æ–°**
  - è¿è¡Œ `npm audit`
  - ä¿®å¤é«˜å±å’Œä¸¥é‡æ¼æ´
  - éªŒè¯æ–¹æ³•:
    ```bash
    npm audit --production
    ```
  - çŠ¶æ€: â³ å¾…æ£€æŸ¥

- [ ] **å®šæœŸå®‰å…¨æ‰«æ**
  - ä½¿ç”¨ Snyk æˆ– Dependabot
  - è‡ªåŠ¨æ£€æµ‹æ¼æ´
  - çŠ¶æ€: â³ å¾…é…ç½®

---

## ğŸŸ¢ ç¬¬ä¸‰ä¼˜å…ˆçº§: æœ€ä½³å®è·µ (å»ºè®®å®Œæˆ)

### 10. æ€§èƒ½å’Œå¯ç”¨æ€§

- [ ] **CDN å·²é…ç½®**
  - é™æ€èµ„æºé€šè¿‡ CDN åˆ†å‘
  - å‡å°‘æœåŠ¡å™¨è´Ÿè½½
  - çŠ¶æ€: â³ å¾…é…ç½®

- [ ] **ç¼“å­˜ç­–ç•¥å·²ä¼˜åŒ–**
  - Redis ç¼“å­˜æ­£å¸¸å·¥ä½œ
  - é™æ€èµ„æºç¼“å­˜æ—¶é—´åˆç†
  - çŠ¶æ€: â³ å¾…ä¼˜åŒ–

- [ ] **è´Ÿè½½å‡è¡¡å·²é…ç½®**
  - PM2 cluster æ¨¡å¼
  - å¤šå®ä¾‹è¿è¡Œ
  - çŠ¶æ€: â³ å¾…é…ç½®

### 11. å¤‡ä»½å’Œæ¢å¤

- [ ] **æ•°æ®åº“å¤‡ä»½ç­–ç•¥**
  - æ¯æ—¥å…¨é‡å¤‡ä»½
  - æ¯å°æ—¶å¢é‡å¤‡ä»½ (å¯é€‰)
  - å¤‡ä»½ä¿ç•™ 30 å¤©
  - çŠ¶æ€: â³ å¾…é…ç½®

- [ ] **æ–‡ä»¶å¤‡ä»½ç­–ç•¥**
  - ä¸Šä¼ æ–‡ä»¶å®šæœŸå¤‡ä»½
  - å¤‡ä»½åˆ°å¼‚åœ°å­˜å‚¨
  - çŠ¶æ€: â³ å¾…é…ç½®

- [ ] **æ¢å¤æµç¨‹å·²æµ‹è¯•**
  - å®šæœŸæµ‹è¯•å¤‡ä»½æ¢å¤
  - è®°å½•æ¢å¤æ—¶é—´ (RTO)
  - çŠ¶æ€: â³ å¾…æµ‹è¯•

### 12. åˆè§„æ€§

- [ ] **éšç§æ”¿ç­–å·²å‘å¸ƒ**
  - ç¬¦åˆ GDPR/CCPA è¦æ±‚ (å¦‚é€‚ç”¨)
  - ç”¨æˆ·æ•°æ®å¤„ç†é€æ˜
  - çŠ¶æ€: â³ å¾…å‘å¸ƒ

- [ ] **ç”¨æˆ·æ•°æ®åŠ å¯†**
  - æ•æ„Ÿæ•°æ®åŠ å¯†å­˜å‚¨
  - ä½¿ç”¨ `STORAGE_ENCRYPTION_KEY`
  - çŠ¶æ€: â³ å¾…éªŒè¯

- [ ] **å®¡è®¡æ—¥å¿—**
  - è®°å½•å…³é”®æ“ä½œ (ç™»å½•ã€åˆ é™¤ã€ä¿®æ”¹è®¾ç½®)
  - æ—¥å¿—ä¸å¯ç¯¡æ”¹
  - çŠ¶æ€: â³ å¾…é…ç½®

---

## ğŸ“Š å®‰å…¨è¯„åˆ†

æ ¹æ®å®Œæˆæƒ…å†µè®¡ç®—å®‰å…¨è¯„åˆ†:

| ä¼˜å…ˆçº§ | æ€»é¡¹æ•° | å·²å®Œæˆ | å®Œæˆç‡ | æƒé‡ |
|--------|--------|--------|--------|------|
| ğŸ”´ ç¬¬ä¸€ä¼˜å…ˆçº§ | 20 | 4 | 20% | 50% |
| ğŸŸ¡ ç¬¬äºŒä¼˜å…ˆçº§ | 15 | 0 | 0% | 30% |
| ğŸŸ¢ ç¬¬ä¸‰ä¼˜å…ˆçº§ | 10 | 0 | 0% | 20% |

**å½“å‰å®‰å…¨è¯„åˆ†**: 10/100

**ç›®æ ‡å®‰å…¨è¯„åˆ†**: 
- æœ€å°å¯è¡Œéƒ¨ç½²: 80/100 (å®Œæˆæ‰€æœ‰ç¬¬ä¸€ä¼˜å…ˆçº§)
- æ¨èéƒ¨ç½²: 90/100 (å®Œæˆç¬¬ä¸€ã€ç¬¬äºŒä¼˜å…ˆçº§)
- æœ€ä½³å®è·µ: 95/100 (å®Œæˆæ‰€æœ‰é¡¹ç›®)

---

## ğŸ” éªŒè¯è„šæœ¬

åˆ›å»º `scripts/security-check.sh`:

```bash
#!/bin/bash

echo "=== ç”Ÿäº§ç¯å¢ƒå®‰å…¨æ£€æŸ¥ ==="
echo ""

# 1. æ£€æŸ¥ç¯å¢ƒå˜é‡
echo "1. æ£€æŸ¥ç¯å¢ƒå˜é‡..."
if [ -f .env.production ]; then
    echo "âœ… .env.production å­˜åœ¨"
    
    # æ£€æŸ¥å…³é”®é…ç½®
    if grep -q "inventory-management-secret-key-for-development" .env.production; then
        echo "âŒ NEXTAUTH_SECRET ä»ä½¿ç”¨å¼€å‘ç¯å¢ƒå¯†é’¥!"
    else
        echo "âœ… NEXTAUTH_SECRET å·²æ›´æ–°"
    fi
    
    if grep -q "dev-storage-encryption-key" .env.production; then
        echo "âŒ STORAGE_ENCRYPTION_KEY ä»ä½¿ç”¨å¼€å‘ç¯å¢ƒå¯†é’¥!"
    else
        echo "âœ… STORAGE_ENCRYPTION_KEY å·²æ›´æ–°"
    fi
else
    echo "âŒ .env.production ä¸å­˜åœ¨!"
fi
echo ""

# 2. æ£€æŸ¥ Git å¿½ç•¥
echo "2. æ£€æŸ¥ Git é…ç½®..."
if git check-ignore .env.production > /dev/null 2>&1; then
    echo "âœ… .env.production å·²åœ¨ .gitignore ä¸­"
else
    echo "âŒ .env.production æœªåœ¨ .gitignore ä¸­!"
fi
echo ""

# 3. æ£€æŸ¥è®¤è¯ç»•è¿‡
echo "3. æ£€æŸ¥è®¤è¯ç»•è¿‡..."
if grep -q "if (env.NODE_ENV === 'development')" lib/api/middleware.ts; then
    echo "âŒ å‘ç°å¼€å‘ç¯å¢ƒè®¤è¯ç»•è¿‡!"
else
    echo "âœ… æœªå‘ç°å¼€å‘ç¯å¢ƒè®¤è¯ç»•è¿‡"
fi
echo ""

# 4. æ£€æŸ¥å®‰å…¨å¤´
echo "4. æ£€æŸ¥å®‰å…¨å¤´é…ç½®..."
if grep -q "Content-Security-Policy" middleware.ts; then
    echo "âœ… CSP å·²é…ç½®"
else
    echo "âŒ CSP æœªé…ç½®!"
fi
echo ""

# 5. æ£€æŸ¥ä¾èµ–æ¼æ´
echo "5. æ£€æŸ¥ä¾èµ–æ¼æ´..."
npm audit --production --audit-level=high
echo ""

echo "=== æ£€æŸ¥å®Œæˆ ==="
```

ä½¿ç”¨æ–¹æ³•:

```bash
chmod +x scripts/security-check.sh
./scripts/security-check.sh
```

---

## ğŸ“ éƒ¨ç½²å‰æœ€ç»ˆæ£€æŸ¥

åœ¨éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒå‰,è¯·ç¡®è®¤:

### âœ… ä»£ç è´¨é‡
- [ ] æ‰€æœ‰ TypeScript é”™è¯¯å·²ä¿®å¤
- [ ] æ‰€æœ‰ ESLint Error å·²ä¿®å¤
- [ ] ä»£ç å·²é€šè¿‡ Prettier æ ¼å¼åŒ–
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡

### âœ… å®‰å…¨é…ç½®
- [ ] æ‰€æœ‰ç¬¬ä¸€ä¼˜å…ˆçº§é¡¹ç›®å·²å®Œæˆ
- [ ] å¯†é’¥å·²æ›´æ–°ä¸ºå¼ºå¯†é’¥
- [ ] SSL è¯ä¹¦å·²é…ç½®
- [ ] å®‰å…¨å¤´å·²æ­£ç¡®è®¾ç½®

### âœ… ç¯å¢ƒé…ç½®
- [ ] .env.production å·²åˆ›å»ºå¹¶é…ç½®
- [ ] æ•°æ®åº“å·²åˆ›å»ºå¹¶è¿ç§»
- [ ] Redis å·²å®‰è£…å¹¶é…ç½®
- [ ] Nginx å·²é…ç½®

### âœ… æµ‹è¯•éªŒè¯
- [ ] æœ¬åœ°ç”Ÿäº§æ„å»ºæµ‹è¯•é€šè¿‡
- [ ] åŠŸèƒ½æµ‹è¯•é€šè¿‡
- [ ] æ€§èƒ½æµ‹è¯•é€šè¿‡
- [ ] å®‰å…¨æµ‹è¯•é€šè¿‡

---

## ğŸš¨ ç´§æ€¥è”ç³»

å¦‚æœå‘ç°å®‰å…¨é—®é¢˜:

1. **ç«‹å³åœæ­¢æœåŠ¡**
   ```bash
   pm2 stop all
   ```

2. **è¯„ä¼°å½±å“èŒƒå›´**
   - æ£€æŸ¥æ—¥å¿—
   - æ£€æŸ¥æ•°æ®åº“
   - æ£€æŸ¥ç”¨æˆ·æ•°æ®

3. **ä¿®å¤é—®é¢˜**
   - æ›´æ–°ä»£ç 
   - æ›´æ–°é…ç½®
   - é‡æ–°éƒ¨ç½²

4. **é€šçŸ¥ç”¨æˆ·** (å¦‚éœ€è¦)
   - å‘é€å®‰å…¨é€šçŸ¥
   - å»ºè®®ç”¨æˆ·ä¿®æ”¹å¯†ç 

---

## ğŸ“š å‚è€ƒèµ„æº

- [OWASP Top 10](https://owasp.org/www-project-top-ten/)
- [Next.js Security Best Practices](https://nextjs.org/docs/app/building-your-application/configuring/security)
- [Node.js Security Best Practices](https://nodejs.org/en/docs/guides/security/)
- [Prisma Security Best Practices](https://www.prisma.io/docs/guides/security)

---

**æœ€åæ›´æ–°**: 2025-10-02
**ä¸‹æ¬¡å®¡æŸ¥**: 2025-11-02 (æ¯æœˆå®¡æŸ¥ä¸€æ¬¡)

